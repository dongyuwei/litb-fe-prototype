##兰亭前端现存问题：##
1. **开发模式**：前后端耦合太紧，js，css内嵌在php(html)中，模块化程度有限，代码复用度不高。
2. **模板系统**：无法有效支持快速分支的并行开发模式；在线编辑器功能太弱，缺乏全文查找和语法校验等基本功能。
3. **重复工作**：模板部分在前后端重复模块化2次；模板系统提供了widget，后端又重新封装一遍。
4. **源码版本控制**：模板系统中前端静态资源没有版本控制；前后端共用一个svn仓库导致文件数量膨胀，源码分支合并回滚等操作不方便；svn仓库中js和css源码是压缩版，但压缩比率较低。
5. **发布流程**：前后端代码一起上线，不利于快速发布，不利于快速hotfix。

##兰亭前端模块化架构设计目标：##
1. **前后端分离**：前端源码独立控制，消除页面内嵌js，css。
2. **模块化**：js，css，html均模块化，提高代码复用度。清晰的依赖关系管理，使修改更安全，扩展更容易。
3. **模板复用**：前端提供模板，后端只提供渲染模板需要的数据及接口。模板和数据是严格分离的。
4. **并行开发**：前后端可并行开发，后端只关心提供数据及接口服务。多项目可并行开发，可快速分支开发。
5. **独立发布**：前端代码（js，css，img）可独立发布上线（快速发布，频繁发布），加快功能迭代和hotfix速度。

###合理的架构可以让新手快速成长，独当一面;对多项目多任务可快速响应###

##设计规划##
1. **JS模块化**：
 1. 组件使用jQuery（or zepto）插件方式来组织代码；
	2. 统一的namespace管理；
	3. 使用require('a/b/c.js');方式引用依赖模块；
	4. 使用（jQuery）自定义事件在组件之间交换信息。
2. **CSS模块化**：
	1. css使用@import url('a/b/c.css');方式引用依赖。
	2. 统一的namespace管理
	3. 最大程度上集成，复用bootstrap这个css框架。并且在css模块化规划上借鉴其设计。
3. **HTML模块化**：采用无逻辑模板引擎Mustache.php来组装html，隔离标签和代码逻辑。
	1. 前端提供模板，后端提供数据和数据接口。
	2. Page：单个页面，引用多个pagelet。
	3. Pagelet：单个业务逻辑相关模块（较独立的视图区块），引用多个widget。
	4. widget：业务无关的独立html片段（引用一个js和一个css）。
	5. js和css引用：page模板中可引用自身对应的一个js和1个css，分别引入依赖的js和css，负责模块组装和模块通信逻辑。pagelet和widget模板文件中不直接引用对应的js和css；在测试文件中可引入自身依赖的js，css。
4. **I18n**： 前端只在html模板上提供可替换标记，具体语言包由后端提供。图片尽量不涉及国际化内容。
5. **img**：img目录位于src 根目录，按照功能模块划分目录。
6. **测试**：自动测试与人工测试相结合。提供在线预览服务，可以根据模板同级目录下data.json自动渲染模板；也可以在线输入模板需要的json数据来查看渲染效果。
7. **Svn规划**：
	1. 前端使用*独立*svn仓库。
	2. **trunk**用于常规开发，上线；
	3. **branches**用于特性开发，开发完合并到主干；
	4. **tags** 用于存储上线发布的资源，可用于快速回滚。
8. **目录结构规划** 参见本项目目录结构。

##开发流程##
1. **开发,自测**：在线预览测试。
2. **联调**：测试机检出代码，build，使用debug版静态资源测试。测试通过后，使用release版。为复用测试机，可为静态资源配置虚拟主机，按需修改对静态资源的引用。

##发布流程##
1. 静态资源发布上线前合并，压缩成单个文件。Build目录下提供自动构建工具。
2. 发布时计算资源md5值，替换模板中对该资源的引用，使用该值控制资源缓存。形如src=http://cloud.lbox.me/tag-123/fe/test.js?v=md5-hash
3. 发布debug和release版。debug版只合并，不压缩混淆。release版合并且压缩代码。
4. 测试通过后通过提交到svn tags中，发布到cdn。批量发布 or 增量发布 ？
5. 回滚：大版本回滚使用tag版本号；单独回滚或者上线是使用md5小版本号。
6. md5 hash mapping.json






